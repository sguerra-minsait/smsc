<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8">
<title>WebPush Custom Activity SMSC Integration</title>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/postmonger.js"></script>
<script type="text/javascript" src="customActivity.js"></script>
<script type="text/javascript" src="js/custom_calendar.js"></script>
<link rel="stylesheet" type="text/css" href="css/salesforce-lightning-design-system.min.css">
<link rel="stylesheet" type="text/css" href="css/main.css">
<link rel="stylesheet" type="text/css" href="css/samsung_fonts.css">
</head>
<body>
<form id="form" action="javascript:void(0)">
<div id="template" class="step">
	<div class="slds-form-element">
		<label class="slds-form-element__label" for="message">Message(<font style="color:red">*</font>)</label>
		<div class="slds-form-element__control">
			<textarea id="message" value='Esto es una prueba %%get("de1", "prop")%%' name="message" class="slds-textarea" placeholder="Type your message" rows="5"></textarea>
			<font id="message_rest_space"></font>
		</div>
		<div class="slds-text-color_error"></div>
	</div>
	<div style="display: flex;margin-top: 10px;">
		<button class="slds-button slds-button_brand" id="short_url_button">Add short URL</button>
		<div class="slds-form-element" style="width: 100%">
			<div class="slds-form-element__control">
				<input type="text" id="short_url" placeholder="https://www.large_url.com" class="slds-input"/>
			</div>
			<div id="invalid_url" class="slds-text-color_error"></div>
		</div>
	</div>

		<!--

	<span class="slds-icon_container slds-icon-utility-announcement" title="Short URLS" id="short_url_message">
		We have detected URLs in your message, Do you want to make them shorter? 
		<button class="slds-button slds-button_brand" id="shorter_urls_in_message">Yes</button>
		<svg class="slds-icon slds-icon-text-default" aria-hidden="true" style="width: 1.5rem; height: 1.5rem">
			<use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#apex"></use>
		</svg>
	</span>
		-->

	<span id="short_url_loading">Loading...</span>
	<div class="slds-form-element">
		<label class="slds-form-element__label" for="footer">Footer</label>
		<div class="slds-form-element__control">
			<div class="slds-select_container">
				<select class="slds-select" id="footer" name="footer">
					<option value="" selected="selected">Please, select your footer</option>
				</select>
			</div>
		</div>
	</div>
</div>


<div id="delivery" class="step">
<div class="slds-form-element">
	<div class="slds-form-element__control">
		<div class="slds-checkbox">
			<input type="checkbox" name="options" id="expiration_date_checkbox" value="true" checked="checked" />
			<label class="slds-checkbox__label" for="expiration_date_checkbox">
				<span class="slds-checkbox_faux"></span>
				<span class="slds-form-element__label">Expiration date</span>
		  </label>
		</div>
	</div>
</div>
	<div id="maintain_date" style="display: inline-block;">
	  <div class="slds-form-element slds-dropdown-trigger slds-dropdown-trigger_click">
		<div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right custom_calendar_input_container" style="display: inline-block;">
		  <input type="text" placeholder=" " class="slds-input" value="" id="maintain_date_value" name="maintain_date_value" />
		  <button class="slds-button slds-button_icon slds-input__icon slds-input__icon_right" title="Select a date">
			<svg class="slds-button__icon" aria-hidden="true">
			  <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#event"></use>
			</svg>
			<span class="slds-assistive-text">Select a date</span>
		  </button>
		</div>
		<div aria-hidden="false" aria-label="Date picker: June" class="slds-datepicker slds-dropdown slds-dropdown_left" role="dialog">
		  <div class="slds-datepicker__filter slds-grid">
			<div class="slds-datepicker__filter_month slds-grid slds-grid_align-spread slds-grow">
			  <div class="slds-align-middle">
				<button class="slds-button slds-button_icon slds-button_icon-container custom_prev_month" title="Previous Month">
				  <svg class="slds-button__icon" aria-hidden="true">
					<use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#left"></use>
				  </svg>
				  <span class="slds-assistive-text ">Previous Month</span>
				</button>
			  </div>
			  <h2 aria-atomic="true" aria-live="assertive" class="slds-align-middle custom_month">June</h2>
			  <div class="slds-align-middle">
				<button class="slds-button slds-button_icon slds-button_icon-container custom_next_month" title="Next Month">
				  <svg class="slds-button__icon" aria-hidden="true">
					<use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#right"></use>
				  </svg>
				  <span class="slds-assistive-text">Next Month</span>
				</button>
			  </div>
			</div>
			<div class="slds-shrink-none">
			  <label class="slds-assistive-text" for="maintain_date_year">Pick a Year</label>
			  <div class="slds-select_container">
				<select class="slds-select custom_year_select" id="maintain_date_year">
				</select>
			  </div>
			</div>
		  </div>
		  <table aria-labelledby="month" aria-multiselectable="true" class="slds-datepicker__month" role="grid">
			<thead>
			  <tr class="weekdays">
				<th scope="col">
				  <abbr title="Sunday">Sun</abbr>
				</th>
				<th scope="col">
				  <abbr title="Monday">Mon</abbr>
				</th>
				<th scope="col">
				  <abbr title="Tuesday">Tue</abbr>
				</th>
				<th scope="col">
				  <abbr title="Wednesday">Wed</abbr>
				</th>
				<th scope="col">
				  <abbr title="Thursday">Thu</abbr>
				</th>
				<th scope="col">
				  <abbr title="Friday">Fri</abbr>
				</th>
				<th scope="col">
				  <abbr title="Saturday">Sat</abbr>
				</th>
			  </tr>
			</thead>
			<tbody class="custom_days_body">
			</tbody>
		  </table>
		  <button class="slds-button slds-align_absolute-center slds-text-link custom_go_today">Today</button>
		</div>
		<div style="display: inline-block;">
			<div style="position: relative">
				<select id="maintain_hour" class="select_time_picker"></select>
				<span class="slds-icon_container maintain_hour_icon slds-icon-utility-clock slds-input__icon slds-input__icon_right"><svg class="slds-icon slds-icon slds-icon_x-small slds-icon-text-default" aria-hidden="true"><use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#clock"></use></svg></span>
			</div>
		</div>
		<div class="slds-text-color_error"></div>
	  </div>

	</div>
	<br>
	<br>
	<div class="slds-form-element">
		<label class="slds-form-element__label click_event_label" for="type">Type (<font style="color:red;">*</font>)</label>
		<br>
		<div class="slds-form-element__control">
			<div class="slds-select_container">
				<select class="slds-select" id="type" name="type">
					<option value="" selected="selected">Please, select your type</option>
				</select>
			</div>
		</div>
	</div>
	<br>
	<div class="slds-form-element">
		<label class="slds-form-element__label  click_event_label" for="tern">Sender (<font style="color: red;">*</font>)</label>
		<br>
		<div class="slds-form-element__control">
			<div class="slds-select_container">
				<select class="slds-select" id="sender" name="sender">
					<option value="" selected="selected">Please, select your sender</option>
				</select>
			</div>
		</div>
	</div>
</div>

<div id="testing" class="step">
	<div style="height: 90px;">
		<div class="slds-form-element" style="display: inline-block;float: left">
			<label class="slds-form-element__label " for="test_number">
				Number
			</label>

			<div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right slds-border_bottom">
				<svg class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default scm-anchor-right" aria-hidden="true">
					<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="scm-anchor-right">
						<path d="M4.4 15.4l4.1 4.1c.2.2.5.2.6 0L19.4 9.2c.2-.2.2-.4 0-.6l-4.1-4.1c-.2-.2-.4-.2-.6 0L4.4 14.8c-.2.2-.2.5 0 .6zM16.7 2.6c-.2.2-.2.5 0 .7l4 4c.2.2.5.2.7 0l1.1-1.1c.8-.7.8-1.8 0-2.6l-2.1-2.1c-.8-.8-1.9-.8-2.7 0l-1 1.1zM1 22.2c-.1.5.3.9.8.8l5-1.2c.2 0 .3-.1.4-.2l.1-.1c.1-.1.1-.4-.1-.6l-4.1-4.1c-.2-.2-.5-.2-.6-.1l-.1.1c-.1.1-.2.3-.2.4l-1.2 5z"></path>
					</svg>
				</svg>
				<div><input type="text" id="test_number" maxlength="20" class="slds-input"></div>
			</div>
			<div class="slds-text-color_error"></div>
		</div>
		<button class="slds-button slds-button_brand" id="test_message_button" style="float: left;margin-top: 24px; margin-left: 20px;">Send one test message!</button>
		<div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_success" role="alert" id="message_test_success">
			<span class="slds-icon_container slds-icon-utility-error slds-m-right_x-small" title="Success">
				<svg class="slds-icon slds-icon_x-small" aria-hidden="true">
					<use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#success"></use>
				</svg>
			</span>
			<h2>Your message was successfully sent !</h2>
			<div class="slds-notify__close">
				<button class="slds-button slds-button_icon slds-button_icon-small slds-button_icon-inverse" title="Close" onclick="$('#message_test_success').hide();">
					<svg class="slds-button__icon" aria-hidden="true">
					<use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close"></use>
					</svg>
					<span class="slds-assistive-text">Close</span>
				</button>
			</div>
		</div>

		<div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert" id="message_test_error">
			<span class="slds-assistive-text">error</span>
			<span class="slds-icon_container slds-icon-utility-error slds-m-right_x-small" title="Description of icon when needed">
			<svg class="slds-icon slds-icon_x-small" aria-hidden="true">
				<use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#error"></use>
			</svg>
			</span>
			<h2>There was an error ! Please, try again in a few minutes.</h2>
			<div class="slds-notify__close">
				<button class="slds-button slds-button_icon slds-button_icon-small slds-button_icon-inverse" title="Close" onclick="$('#message_test_error').hide();">
				<svg class="slds-button__icon" aria-hidden="true">
				<use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close"></use>
				</svg>
				<span class="slds-assistive-text">Close</span>
				</button>
			</div>
		</div>
	</div>
	<div id="phone_preview_container">
		<div class="phone_image_preview_container">
			<img src="images/android_sms_preview_2.png">
		</div>
		<div id="message_preview"></div>
		<div id="sender_preview"></div>
		<div id="time_preview"></div>
	</div>
</div>
<!--<div id="error_box" class="slds-text-color_error"></div>-->
</form>
<div id="popup"></div>


<script>

function show_popup(data){
	data = decodeURIComponent(data);
	$('#popup').text(data).css('display', 'block');
}
function hide_popup(){
	$('#popup').css('display', 'none');
}

(function(){
	var year = new Date().getFullYear();
	var c = new CustomCalendar($('#maintain_date'), {
		years: {from: year, to: year + 50}
	});

	function set_height_preview(){
		return;
		var p = document.querySelector('#message_preview');
		p.style.height = 'auto';
		if(p.scrollHeight > 310)return p.style.height = '310px';
		if(p.scrollHeight < 50)return p.style.height = '50px';
		p.style.height = (p.scrollHeight) + 'px';
	}

	$('#expiration_date_checkbox').change(function(){
		if(!this.checked){
			$('#maintain_date_value, #maintain_hour').attr('disabled', 'disabled');
		}else{
			$('#maintain_date_value, #maintain_hour').removeAttr('disabled');
		}
	});



/*
	var message_preview = document.querySelector('#message_preview');
	message_preview.setAttribute('style', 'height:' + (message_preview.scrollHeight) + 'px;overflow-y:hidden;');
	$(message_preview).on('input change keyup cut', function () {
		set_height_preview();
	});
*/

	$('#message').on('change paste keyup cut',function(){
		var v = this.value;
		$('#message_rest_space').text(v.length + " caracteres de 160");
	});
	$('#sender').change(function(){
		$('#sender_preview').text(this.value);
	});


	$(document).ready(function(){
		var xMousePos = 0;
		var yMousePos = 0;
		var lastScrolledLeft = 0;
		var lastScrolledTop = 0;

		$(document).mousemove(function(event) {
			xMousePos = event.pageX;
			yMousePos = event.pageY;
			movePopup();
		})  

		$(window).scroll(function(event) {
			if(lastScrolledLeft != $(document).scrollLeft()){
				xMousePos -= lastScrolledLeft;
				lastScrolledLeft = $(document).scrollLeft();
				xMousePos += lastScrolledLeft;
			}
			if(lastScrolledTop != $(document).scrollTop()){
				yMousePos -= lastScrolledTop;
				lastScrolledTop = $(document).scrollTop();
				yMousePos += lastScrolledTop;
			}
			movePopup();
		});
		function movePopup(event){
			var frame = {
				width: $(document).width(),
				height: $(document).height()
			}

			var popup = $('#popup');
			var width = parseInt(popup.css('width'));
			var height = parseInt(popup.css('height'));
			var left = xMousePos - width/2;
			var top = yMousePos - height - 10;

			if(xMousePos - lastScrolledLeft - width/2 <= 0){
				left = 0;
			}else if(xMousePos - lastScrolledLeft + width/2 + 2 >= frame.width){
				left = frame.width - width - 2;
			}

			popup.css({
				left: left,
				top: yMousePos - lastScrolledTop - height > 0 ? top : lastScrolledTop
			});
		}
	 
	});



	setInterval(change_time_preview, 60000);
	function change_time_preview(){
		var d = new Date();
		$('#time_preview').text(d.getHours() + ':' + d.getMinutes());
	}
	change_time_preview();
})();
</script>
</body>
</html>